
<main>
  <div id="console"> </div>
  <div class="diapo">
      <div class="elements">
         
                          
                          
                          
        {% assign premier = true %}
        {%for block in section.blocks %}
        		{% if premier == true%}
                  	<div class="element active"> 
						<div class="rogne">
                          <img class="imageHomePage" srcset ="{{block.settings.image | img_url:'master'}}" style="filter: brightness({{block.settings.blackFiltre}}%);" draggable="false"/>
                      	</div> 
                      {% if block.settings.centre == "droite" %}
                      <div class="caption" style="align-items:flex-end; right:{{block.settings.distance}}%; top:{{block.settings.hauteur}}%;"> 
                      {% elsif block.settings.centre == "gauche" %}
                      <div class="caption" style="align-items:flex-start; left:{{block.settings.distance}}%; top:{{block.settings.hauteur}}%;"> 
                      {% else %}
                        <div class="caption" style="align-items:centre; left:{{block.settings.distance}}%; top:{{block.settings.hauteur}}%;">  
                      {% endif %}  
                        <h2 class="titre">{{block.settings.heading}}</h2>
                        <h3 class="sousText">{{block.settings.sousText}}</h3>
                        
						
                          {% if block.settings.buttonText != blank %} 
                          
                          <a class="lienHomePage" href="{{block.settings.buttonLien}}">
                            <div class="bouton"><p class="textBouton">{{block.settings.buttonText}}</p></div>
                          </a>
               			  {% endif %}   
                         
                        
 							  
                      </div>
                    </div>
            		{% assign premier = false %} 
            	{% elsif premier == false%}
                    <div class="element">
 						<div class="rogne">
                            <img class="imageHomePage" srcset ="{{block.settings.image | img_url:'master'}}" style="filter: brightness({{block.settings.blackFiltre}}%);" draggable="false"/>
                      	</div>
                        {% if block.settings.centre == "droite" %}
                        <div class="caption" style="align-items:flex-end; right:{{block.settings.distance}}%; top:{{block.settings.hauteur}}%;">
                        {% elsif block.settings.centre == "gauche" %}
                        <div class="caption" style="align-items:flex-start; left:{{block.settings.distance}}%; top:{{block.settings.hauteur}}%;"> 
                        {% else %}
                          <div class="caption" style="align-items:centre; left:{{block.settings.distance}}%; top:{{block.settings.hauteur}}%;">  
                        {% endif %} 
                          <h2 class="titre">{{block.settings.heading}}</h2>
                          <h3 class="sousText">{{block.settings.sousText}}</h3>
 
                           {% if block.settings.buttonText != blank %} 
                          
                          <a class="lienHomePage" href="{{block.settings.buttonLien}}">
                            <div class="bouton"><p class="textBouton">{{block.settings.buttonText}}</p></div>
                          </a>
               			  {% endif %}  
               

                        </div>
                      </div> 
            	{% endif %}
          
        {%endfor%}
        {% assign premier = true %}
        {%for block in section.blocks %}
        		{% if premier == true%}
                  	<div class="element active"> 
						<div class="rogne">
                          <img class="imageEnPlus" srcset ="{{block.settings.image | img_url:'master'}}" style="filter: brightness({{block.settings.blackFiltre}}%);" draggable="false"/>
                      	</div>
                      	{% if block.settings.centre == "droite" %}
                        <div class="caption" style="align-items:flex-end; right:{{block.settings.distance}}%; top:{{block.settings.hauteur}}%;">
                        {% elsif block.settings.centre == "gauche" %}
                        <div class="caption" style="align-items:flex-start; left:{{block.settings.distance}}%; top:{{block.settings.hauteur}}%;"> 
                        {% else %}
                          <div class="caption" style="align-items:centre; left:{{block.settings.distance}}%; top:{{block.settings.hauteur}}%;">  
                        {% endif %}    
                        <h2 class="titre">{{block.settings.heading}}</h2>
                        <h3 class="sousText">{{block.settings.sousText}}</h3> 

                        {% if block.settings.buttonText != blank %} 
                          
                          <a class="lienHomePage" href="{{block.settings.buttonLien}}">
                            <div class="bouton"><p class="textBouton">{{block.settings.buttonText}}</p></div>
                          </a>
               			  {% endif %} 
                        
 							 
                      </div>
                    </div>
            		{% assign premier = false %} 
                {%endif%} 
         {% endfor %}
       </div>
    {% if section.settings.fleche %}
    <div id="nav-gauche" class="las la-chevron-left"><img id="image-gauche" src="{{section.settings.fleche | img_url:'50px'}}"></div>	
    <div id="nav-droite" class="las la-chevron-right"><img src="{{section.settings.fleche | img_url:'50px'}}"></div>
    {% else %}
    <div id="nav-gauche" class="las la-chevron-left">←</div>	
    <div id="nav-droite" class="las la-chevron-right">→</div>
    {% endif %} 
    <div class="informationBox">
       <div id="petitPoint">
       </div>
      
    </div> 
    
    <div id="data" style="color:rgba(0,0,0,0);"> 
        <h5 id="time">
          {{section.settings.transitionTime}}
        </h5> 
        <h5 id ="color1">  
          {{section.settings.points}}
        </h5>
        <h5 id ="color2"> 
          {{section.settings.lePoint}} 
        </h5>
      </div>
    
  </div>
</main>
{% schema %} 
  {
    "name": "Diaporama",
    "settings": [
					
  					{
						"type":"text",
						"label":"temp entre les transition (en ms)",
						"id":"transitionTime"
					},
					{
						"type":"image_picker",
						"label":"Les flêches",
						"id" : "fleche"
					},
					{
						"type":"color",
						"label":"les points", 
						"id" : "points" 
					},
					{
						"type":"color",
						"label":"le Point",
						"id" : "lePoint"
					}

				],
	"blocks" : [
				{
					"type":"image",
					"name":"image block",
					"settings":[
								{
									"type":"image_picker",
									"label":"Les images",
									"id" : "image"
								},
								{
									"type":"range",
									"label":"filtre noir",
									"id" : "blackFiltre",
									"min" :0, 
									"max" :100,
									"step":1,
									"unit":"%",
									"default":100
								},
								{
                                    "type":"text",
                                    "label":"titre",
                                    "id":"heading"
                                },
                                {
                                    "type":"text",
                                    "label":"sous-text",
                                    "id":"sousText"
                                },
                                {
                                    "type":"text",
                                    "label":"text-bouton",
                                    "id":"buttonText"
                                },
                                {
                                    "type":"text",
                                    "label":"lien-bouton",
                                    "id":"buttonLien"
                                }, 
                				{
                                    "type": "select",
                                    "id": "centre",  
                                    "label":"positionnement",
                      				"default": "droite", 
									"options": [
                                                  {
                                                    "value": "droite",
                                                    "label": "droite"
        										  },
        										  {
                                                    "value": "centre",
                                                    "label": "centre"
        										  }, 
        										  {
                                                    "value": "gauche",
                                                    "label": "gauche"
        										  }
        									  ]
        						},
        

								{
									"type":"range",
									"label":"distance du bord",
									"id" : "distance", 
									"min" :0, 
									"max" :100,
									"step":1,
									"unit":"%",
									"default":40 
								},
                      			{
									"type":"range",
									"label":"distance du haut",
									"id" : "hauteur", 
									"min" :0, 
									"max" :100,
									"step":1,
									"unit":"%",
									"default":40 
								}
								]
				}
	],
    "presets": [
                    {
                      "name": "Diaporama",
                      "category": "banner"
                    }
	
    ]
  }
{% endschema %}

{% stylesheet %}
                      
body {
   overflow-x: hidden; 
} 

#data{ 
  z-index:-10;
  position:absolute;
  top:10%;
  left:4000px;
}  
 
 

body{
	margin:0;
}

main{
	width:100%;
	margin:auto;
}

.diapo{
	position: relative;
	overflow: hidden;

}  

#nav-droite,#nav-gauche{
	position: absolute;
	top: 30%;  
	transform: translateY(-50%);
	color: white;
	font-size: 3em;
	
	width:100px;
	height:50px;

	cursor:pointer;
    
}

#nav-droite{
	right: -30px;  
}

#nav-gauche{
	left: 15px;  
}

#image-gauche{
	transform: rotate(0.5turn);  
}

.titre{
	 
	color:white;  
	font-size: 30px;
}

.sousText{
	
	color:white;
	font-size: 25px;
}

.lienHomePage{  
  
                      
	
}
.bouton{ 
	width: 200px;  
	height:50px;
	background-color:white;
	border-radius:5px;

	display:flex;
	justify-content:center;
	align-items:center; 
}
.textBouton{ 
	color:blue;
	font-size: 18px
}
.informationBox{
	display:flex;
	justify-content:center;
	align-items:center; 
	flex-direction: column;

	z-index:2;  
	
	position: absolute;
	bottom:50px;  
	width:100%;
	
}




.elements{
	display: flex; 
	transition: all 0.4s ease-out;
	
}

.element{
	flex:1 0 100%;
	position: relative;
}

.element > img{
	width: 100%
}

.imageHomePage{
	
	
	width:100%;
	
	 
}

.caption{
	display: flex;
	
 
	flex-direction: column; 

	position: absolute;
	top: 30%;
   
	transform: translate(-50%, -50%);
	text-align:center;
	
	padding: 30px;
} 


#petitPoint{
	display:flex; 
	justify-content:space-between; 
}

.point{
	font-size:30px; 
	cursor:pointer; 
}
                      
                      
.rogne { position: relative; width: 500px; height: 500px; overflow: hidden; }   

.rogne img { position: absolute; top: 0px; left: -200px; }                             
                      

@media screen and (max-width: 1024px)
{
	.titre{
		font-size: 25px;
        width:100%;
	} 
    .sousText{
		font-size: 20px;
         width:100%;
	}
	.textBouton{
		font-size: 12px; 
	} 
	.informationBox{
  		bottom:20px;  
	
	}
	#nav-droite,#nav-gauche{
		top:60%; 
	} 
	.caption{
		left: 50%;
		justify-content:center; 
		align-items:center;
        width:100%; 
	}  
    #nav-droite,#nav-gauche{
    	z-index:-1;   
        display:none; 
    }
    .lienHomePage{
    	align-self:center;                       
    }
}


 
{% endstylesheet %}

{% javascript %}
	
	
	//variables
	let compteur = 0
    let spam = false
	let timer, elements, slides, slideWidth   
    
	const boitePoint = document.getElementById("petitPoint")

	var time = document.getElementById("time").innerText; 
	var color1 = document.getElementById("color1").innerText;
	var color2 = document.getElementById("color2").innerText;


	window.onload = () => {
	
	const diapo = document.querySelector(".diapo")
	elements = document.querySelector(".elements")
	slides = document.getElementsByClassName("element")
	
	//largeur du diapo
	slideWidth = diapo.getBoundingClientRect().width
	
	let next = document.querySelector("#nav-droite")
	let prev = document.querySelector("#nav-gauche")

	nImage = slides.length -1; 
	
	boitePoint.style.width = nImage*20 + "px"; 
	
	for(i=0;i<nImage;i++){ 
        point = document.createElement("div")  
    	boitePoint.appendChild(point)  
  		
        point.classList.add("point")
        point.innerHTML = "•"
        
                           
        function selectPoint(index){
            point.addEventListener("click",function(){           
              compteur = index
              let decal = -slideWidth * compteur
              elements.style.transform = `translateX(${decal}px)`

              pointColor()
            })
    	}		 
                          
       	selectPoint(i) 
                           
      
    } 
    pointColor() 
                           
    

	next.addEventListener("click",slideNext)
	prev.addEventListener("click",slidePrev) 

	// diapo automatisé

	timer = setInterval(slideNext, time)
    
    next.addEventListener("mouseover",stopTimer)
	next.addEventListener("mouseout",startTimer)

	prev.addEventListener("mouseover",stopTimer)
	prev.addEventListener("mouseout",startTimer)

	//responsive disigne

	window.addEventListener("resize",function(){
	 slideWidth = diapo.getBoundingClientRect().width
	 slideNext() 
	});

	}

	
  function slideNext(){
      if(spam == false){
        let decal
        console.log("test")
        compteur++ 
        if(compteur == nImage){ 
           decal = -slideWidth * (nImage)  
           elements.style.transform = `translateX(${decal}px)`     
           setTimeout(slideNextinfinit,400)     

        }else{ 
          decal = -slideWidth * compteur
          elements.style.transform = `translateX(${decal}px)`
        }        
        spam = true
        setTimeout(pointColor,200)  
        setTimeout(noSpam,400) 
      }
  }
                           
 
  function slidePrev(){ 
      if(spam == false){
        let decal 
        console.log("test") 
        compteur-- 
        if(compteur == -1){
              compteur = nImage
              elements.style.transition= "all 0s ease-out"
              decal = -slideWidth * compteur + decalage[0]  
              elements.style.transform = `translateX(${decal}px)` 
              
              setTimeout(slidePrevInfinit ,1)   
          }
        decal = -slideWidth * compteur
        elements.style.transform = `translateX(${decal}px)`

        spam = true
        setTimeout(pointColor,200)    
        setTimeout(noSpam,400)      
      }
      
  }

	
  function stopTimer(){
		clearInterval(timer)
  }
 
  function startTimer(){
		timer = setInterval(slideNext, time)     
  }

  function pointColor(){
	var lesPoints = document.getElementsByClassName("point")
      for(i=0;i<nImage;i++){
        let pointColor = compteur
        if (pointColor == nImage){
        	pointColor = 0 
        }
		if(i==pointColor){
			lesPoints[i].style.color = color2;    
		}else{
			lesPoints[i].style.color = color1;  
		}
	  }
  
  }

  function slideNextinfinit(){
        elements.style.transition= "all 0s ease-out" 
         compteur = 0  
         decal = -slideWidth * compteur
	  	 elements.style.transform = `translateX(${decal}px)`
         setTimeout(function(){elements.style.transition= "0.4s linear"},10)   
        }
        
                      
  function slidePrevInfinit(){
         
         elements.style.transition= "all 0.4s ease-out" 
         compteur--  
         decal = -slideWidth * compteur
	  	 elements.style.transform = `translateX(${decal}px)`

     	}
                      
  function noSpam(){
  	spam = false
  }
      
//============================================================
                      
  let img = document.querySelectorAll("image")            
  
  for(i=0;i<img.length;i++){
                    
       img[i].setAttribute('draggable', false);  
                             
  }	
                             
        let ele = document.querySelector(".elements")
        let xStart,xEnd
        let push = false;
        let decalage = [0] 
                           
                             
                             
        ele.addEventListener("touchstart", handleStart);
        ele.addEventListener("touchend", handleEnd);
        document.addEventListener("touchmove", handleMove);         

         
           
            ele.addEventListener("mousedown",mouseStart); 
            ele.addEventListener("mousemove",mouseMove);              
            document.addEventListener("mouseup",mouseEnd); 
            
                            
                      
                      
   //========================telephone tactile ================================
                      
      
         
           
        
                       
                   
         function mouseStart(event) {
            
            if(spam == false){
            ele.style.transform == 'none'
            push = true
            elements.style.transition= "all 0s ease-out"   
            stopTimer()
                             
			xStart = event.screenX
            console.log(xStart)
            }
                             
        }             
           
        

		function mouseMove(event) {
            if(spam == false){
          	let decal 
            
            if(push == true){
             
              if(xStart - event.screenX < 0 && compteur == 0){ 

                  decal = -slideWidth * nImage - (xStart - event.screenX)  
                  decalage[0] = xStart - event.screenX  
                   document.getElementById("console").innerHTML = decalage[0] 
              }else{
                  decal = -slideWidth * compteur - (xStart - event.screenX)  
              }                 
              ele.style.transform = `translateX(${decal}px)`
            }
            }
        }
                 
                      
       	function mouseEnd(event) { 
            if(spam == false && push == true){   
            push = false 
            elements.style.transition= "all 0.4s ease-out" 
            startTimer()
            if(xStart - event.screenX < 0 && compteur == 0){ 
                                         
		 		if(xStart - event.screenX < -100){
                  decal = -slideWidth * nImage - (xStart - event.screenX)  
                  decalage[0] = xStart - event.screenX 
                                         
                                         
                                         
                   if(spam == false){
                      
                      console.log("test") 
                      compteur-- 
                      if(compteur == -1){ 
                            compteur = nImage
                            elements.style.transition= "all 0.4s ease-out" 
                             compteur--  
                             decal = -slideWidth * compteur

                        }
                      decal = -slideWidth * compteur
                      elements.style.transform = `translateX(${decal}px)`

                      spam = true
                      setTimeout(pointColor,200)   
                      setTimeout(noSpam,500)  
                    }
                  }else{
                  	 compteur = nImage -1
                      
                      slideNext() 
                  } 
                                           
            }else{  
              if(xStart - event.screenX < -100){   
                  slidePrev()
              }else if(xStart - event.screenX > 100){   
                  slideNext()       
              }else{
                  let decal = -slideWidth * compteur  
                  ele.style.transform = `translateX(${decal}px)` 
              }
            }
            setTimeout(function(){decalage[0] = 0},1000)  
           	console.log(xStart - event.screenX) 
            } 
        }  
                      
                      
          //==================================//  
            
                      
        function handleStart(event) {
            xEnd = 0  
            if(spam == false){
              ele.style.transform == 'none' 
              push = true
              elements.style.transition= "all 0s ease-out"   
              stopTimer()

              xStart = event.touches[0].screenX
              console.log(xStart)
            }
                             
        }             
           
    

		function handleMove(event) {
            if(spam == false){
              let decal 

              if(push == true){

                if(xStart - event.touches[0].screenX < 0 && compteur == 0){ 

                    decal = -slideWidth * nImage - (xStart - event.touches[0].screenX)  
                    decalage[0] = xStart - event.touches[0].screenX  
                     document.getElementById("console").innerHTML = decalage[0] 
                }else{
                    decal = -slideWidth * compteur - (xStart - event.touches[0].screenX)  
                }                 
                ele.style.transform = `translateX(${decal}px)` 
                xEnd = xStart - event.touches[0].screenX
              }
            }
        }
               
                                                        
       	function handleEnd(event) {  
            if(spam == false && push == true){
            push = false 
            elements.style.transition= "all 0.4s ease-out" 
            startTimer()
            if(xEnd < 0 && compteur == 0){ 
                                         
		 		if(xEnd < -100){
                  decal = -slideWidth * nImage - (xEnd)  
                  decalage[0] = xEnd
                                         
                                         
                                         
                   if(spam == false){
                      
                      console.log("test") 
                      compteur-- 
                      if(compteur == -1){ 
                            compteur = nImage
                            elements.style.transition= "all 0.4s ease-out" 
                             compteur--  
                             decal = -slideWidth * compteur

                        }
                      decal = -slideWidth * compteur
                      elements.style.transform = `translateX(${decal}px)` 

                      spam = true
                      setTimeout(pointColor,200)     
                      setTimeout(noSpam,500)  
                    }
                  }else{
                  	 compteur = nImage -1
                      
                      slideNext() 
                  }  
                                           
            }else{  
              if(xEnd < -100){    
                  slidePrev()
              }else if(xEnd > 100){ 
                  slideNext()       
              }else{
                  let decal = -slideWidth * compteur  
                  ele.style.transform = `translateX(${decal}px)` 
              }
            }
            setTimeout(function(){decalage[0] = 0},1000)  
           	console.log(xEnd)  
            }
        }             
        
                      
        let imageEnPlus = document.getElementsByClassName("imageEnPlus")
                      
        imageEnPlus[0].addEventListener("mousedown",function(event){ 
        	
              event.stopPropagation();
              event.preventDefault(); 
                      
        })
        
  //=================option celon la résolution de l'écran ===============================//
        
                      
         /*if(document.width > 1024 ){
                      
       		let titre = document.getElementsByClassName("titre")
            let sousText = document.getElementsByClassName("sousText")
            let informationBox = document.getElementsByClassName("informationBox")
            let caption = document.getElementsByClassName("caption")
            
                              
            titre[0].style.fontSize = "25px";
            sousText[0].style.fontSize = "20px";
            informationBox[0].style.fontSize = "12px";
                      
            titre[0].style.width = "100%";
            sousText[0].style.width = "100%";
                      
            caption[0].style.left = "50%";
            caption[0].style.justifyContent = "center";
            caption[0].style.alignItems = "center";
                      
       
                          
       }*/
                
                      
           let rogne = document.getElementsByClassName("rogne")  
           let imageHomePage = document.getElementsByClassName("imageHomePage") 
                      
           let hautEcran = window.innerHeight 
           let largEcran = window.innerWidth 
           
           let hautIMG = imageHomePage[0].clientHeight   
           let largIMG = imageHomePage[0].clientWidth
                       
           let tauxDeConvertion = hautEcran/largIMG
                      
             console.log(hautEcran)
             console.log(largIMG) 
           document.getElementById("console").innerHTML = tauxDeConvertion   
           
           
           for(i=0;i<rogne.length;i++){ 
           		console.log(i) 
              	rogne[i].style.height = hautEcran + "px" 
                rogne[i].style.width = largEcran +"px"  
                                        
                                        
           }
           
                      
                   
             
                
                      
                      
          
                      
                      
                      
//==========================================================================================//
  
{% endjavascript %}
